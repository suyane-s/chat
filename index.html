<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat App</title>
  <style>
    /* CSS para o aplicativo de chat */
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #f0f0f0;
    }

    #chat-container {
      display: flex;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #fff;
      width: 90vw; /* Responsivo */
      max-width: 600px; /* Responsivo */
      height: 70vh; /* Responsivo */
      max-height: 500px; /* Responsivo */
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    #user-list {
      width: 30%; /* Responsivo */
      min-width: 150px; /* Responsivo */
      border-right: 1px solid #ccc;
      padding: 10px;
      background-color: #2c3e50;
      color: #ecf0f1;
      border-top-left-radius: 8px;
      border-bottom-left-radius: 8px;
    }

    #user-list h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
      color: #ecf0f1;
    }

    #users {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    #users li {
      padding: 10px;
      margin-bottom: 5px;
      background-color: #34495e;
      border-radius: 4px;
      display: flex;
      align-items: center;
      transition: background-color 0.3s;
    }

    #users li:hover {
      background-color: #3b5998;
    }

    #users li .online-indicator {
      width: 10px;
      height: 10px;
      background-color: grey; /* Inicialmente cinza */
      border-radius: 50%;
      margin-right: 10px;
    }

    #users li.online .online-indicator {
      background-color: green; /* Verde para online */
    }

    #users li.offline .online-indicator {
      background-color: red; /* Vermelho para offline */
    }

    #chat {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      border-top-right-radius: 8px;
      border-bottom-right-radius: 8px;
    }

    #messages {
      flex-grow: 1;
      overflow-y: auto;
      padding: 10px;
      border-bottom: 1px solid #ccc;
    }

    .message-container {
      display: flex;
      margin-bottom: 10px;
    }

    .message-container .message {
      padding: 10px;
      border-radius: 4px;
      max-width: 70%;
    }

    .message-container.my-message .message {
      margin-left: auto;
      background-color: #d1e7dd;
    }

    .message-container.other-message .message {
      background-color: #e2e3e5;
    }

    .message-container .timestamp {
      font-size: 12px;
      color: #999;
      margin-left: 10px;
    }

    #messageInput {
      width: calc(100% - 20px);
      padding: 10px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin: 10px;
    }

    #sendButton {
      padding: 10px;
      width: calc(100% - 20px);
      margin: 0 10px 10px 10px;
      border: none;
      background-color: #28a745;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
    }

    #sendButton:hover {
      background-color: #218838;
    }

    #typingStatus {
      font-style: italic;
      color: #999;
      padding: 0 10px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div id="chat-container">
    <div id="user-list">
      <h3>Usuários Online</h3>
      <ul id="users"></ul>
    </div>
    <div id="chat">
      <div id="messages"></div>
      <div id="typingStatus"></div>
      <input type="text" id="messageInput" placeholder="Digite uma mensagem" aria-label="Input de mensagem">
      <button id="sendButton" aria-label="Enviar mensagem">Enviar</button>
    </div>
  </div>

  <script>
    // JavaScript para o aplicativo de chat
    const chat = document.getElementById('chat');
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');
    const messages = document.getElementById('messages');
    const usersList = document.getElementById('users');
    const typingStatus = document.getElementById('typingStatus');

    const socket = new WebSocket('ws://localhost:8080');

    let username = prompt('Digite seu nome de usuário:');
    socket.addEventListener('open', () => {
      socket.send(JSON.stringify({ type: 'join', username }));
    });

    socket.addEventListener('message', event => {
      const data = JSON.parse(event.data);

      if (data.type === 'message') {
        const messageContainer = document.createElement('div');
        messageContainer.classList.add('message-container', data.username === username ? 'my-message' : 'other-message');

        const message = document.createElement('div');
        message.classList.add('message');
        message.textContent = `${data.username}: ${data.message}`;

        // Adicionar timestamp
        const timestamp = new Date().toLocaleTimeString();
        const timestampSpan = document.createElement('span');
        timestampSpan.classList.add('timestamp');
        timestampSpan.textContent = timestamp;

        message.appendChild(timestampSpan);
        messageContainer.appendChild(message);
        messages.appendChild(messageContainer);
        messages.scrollTop = messages.scrollHeight;
      } else if (data.type === 'notification') {
        const notification = document.createElement('div');
        notification.textContent = data.message;
        notification.style.fontStyle = 'italic';
        messages.appendChild(notification);
        messages.scrollTop = messages.scrollHeight;
      } else if (data.type === 'userlist') {
        updateOnlineUsers(data.users);
      } else if (data.type === 'typing') {
        typingStatus.textContent = data.message;
      } else if (data.type === 'status') {
        updateStatus(data.username, data.status);
      }
    });

    sendButton.addEventListener('click', () => {
      const message = messageInput.value;
      if (message.trim() !== '') {
        socket.send(JSON.stringify({ type: 'message', message }));
        const myMessageContainer = document.createElement('div');
        myMessageContainer.classList.add('message-container', 'my-message');

        const myMessage = document.createElement('div');
        myMessage.classList.add('message');
        myMessage.textContent = `${username}: ${message}`;

        // Adicionar timestamp
        const timestamp = new Date().toLocaleTimeString();
        const timestampSpan = document.createElement('span');
        timestampSpan.classList.add('timestamp');
        timestampSpan.textContent = timestamp;

        myMessage.appendChild(timestampSpan);
        myMessageContainer.appendChild(myMessage);
        messages.appendChild(myMessageContainer);
        messages.scrollTop = messages.scrollHeight;
        messageInput.value = '';
        typingStatus.textContent = '';
      }
    });

    messageInput.addEventListener('input', () => {
      socket.send(JSON.stringify({ type: 'typing', username, message: `${username} está digitando...` }));
    });

    messageInput.addEventListener('keyup', event => {
      if (event.key === 'Enter') {
        sendButton.click();
      }
    });

    messageInput.addEventListener('blur', () => {
      socket.send(JSON.stringify({ type: 'typing', username, message: '' }));
    });

    // Função para atualizar a lista de usuários online
    function updateOnlineUsers(users) {
      users.forEach(user => {
        const existingUserItem = document.getElementById(`user-${user.username}`);
        if (!existingUserItem) {
          const userItem = document.createElement('li');
          userItem.id = `user-${user.username}`;
          userItem.classList.add(user.status === 'online' ? 'online' : 'offline');
          const onlineIndicator = document.createElement('div');
          onlineIndicator.classList.add('online-indicator');
          onlineIndicator.classList.add(user.status === 'online' ? 'online' : 'offline');
          userItem.appendChild(onlineIndicator);
          userItem.appendChild(document.createTextNode(user.username));
          usersList.appendChild(userItem);
        } else {
          existingUserItem.className = `user ${user.status === 'online' ? 'online' : 'offline'}`;
          const onlineIndicator = existingUserItem.querySelector('.online-indicator');
          if (onlineIndicator) {
            onlineIndicator.className = `online-indicator ${user.status === 'online' ? 'online' : 'offline'}`;
          }
        }
      });
    }

    // Função para atualizar o status de um usuário específico
    function updateStatus(username, status) {
      const userItem = document.getElementById(`user-${username}`);
      if (userItem) {
        userItem.className = `user ${status === 'online' ? 'online' : 'offline'}`;
        const onlineIndicator = userItem.querySelector('.online-indicator');
        if (onlineIndicator) {
          onlineIndicator.className = `online-indicator ${status === 'online' ? 'online' : 'offline'}`;
        }
      }
    }
  </script>
</body>
</html>
